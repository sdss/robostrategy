#!/usr/bin/env python
# encoding: utf-8
#
# @Author: Michael R. Blanton
# @Date: Aug 3, 2018
# @Filename: rs_allsky_fields
# @License: BSD 3-Clause
# @Copyright: Michael R. Blanton


from __future__ import division
from __future__ import print_function
from __future__ import absolute_import
from __future__ import unicode_literals

import argparse
import os
import sys
import numpy as np
import matplotlib
import matplotlib.pyplot as plt
import fitsio
import robostrategy.sloane as sloane
import robostrategy.params as params
import sdss_access.path

user_robo_data_dir = os.getenv('ROBOSTRATEGY_DATA')
sdss_path = sdss_access.path.Path(release='sdss5')
os.environ['ROBOSTRATEGY_DATA'] = user_robo_data_dir # Above call overwrites user specified directory


if __name__ == '__main__':

    fields_dtype = [('fieldid', np.int32),
                    ('racen', np.float64),
                    ('deccen', np.float64),
                    ('radius', np.float32),
                    ('type', np.dtype('a30'))]
    fields_north_array = np.zeros(0, dtype=fields_dtype)
    fields_south_array = np.zeros(0, dtype=fields_dtype)

    fields_north = sloane.Sloane(n=7682, radius=1.49)
    fields_south = sloane.Sloane(n=18752, radius=0.95)

    tmp_fields_north_array = np.zeros(len(fields_north.ra),
                                          dtype=fields_dtype)
    tmp_fields_north_array['racen'] = fields_north.ra
    tmp_fields_north_array['deccen'] = fields_north.dec
    tmp_fields_north_array['radius'] = fields_north.radius
    tmp_fields_north_array['type'] = 'AllSkySloane'
    fields_north_array = np.append(fields_north_array,
                                   tmp_fields_north_array)

    tmp_fields_south_array = np.zeros(len(fields_south.ra),
                                      dtype=fields_dtype)
    tmp_fields_south_array['racen'] = fields_south.ra
    tmp_fields_south_array['deccen'] = fields_south.dec
    tmp_fields_south_array['radius'] = fields_south.radius
    tmp_fields_south_array['type'] = 'AllSkySloane'
    fields_south_array = np.append(fields_south_array,
                                   tmp_fields_south_array)

    fields_north_array['fieldid'] = np.arange(len(fields_north_array),
                                              dtype=np.int32) + 1
    fields_south_array['fieldid'] = (np.arange(len(fields_south_array),
                                               dtype=np.int32) +
                                     1 + fields_north_array['fieldid'].max())

    fields_north_file = os.path.basename(sdss_path.full('rsFields',
                                                        plan='allsky',
                                                        observatory='apo'))
    fields_south_file = os.path.basename(sdss_path.full('rsFields',
                                                        plan='allsky',
                                                        observatory='lco'))

    fitsio.write(fields_north_file, fields_north_array, clobber=True)
    fitsio.write(fields_south_file, fields_south_array, clobber=True)
